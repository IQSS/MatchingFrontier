<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Compute the balance-sample size frontier for a matchit object — makeFrontier.matchit • MatchingFrontier</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Compute the balance-sample size frontier for a matchit object — makeFrontier.matchit"><meta property="og:description" content="makeFrontier() computes the balance-sample size frontier for a matchit object aftr 1:1 matching. The frontier corresponds to the relationship between the number of matched pairs dropped and the resulting balance in the matched sample. When the propensity score is used to match, this can also correspond to the realtionship between the width of a hypothetical caliper on the propensity score and the resulting balance. This helps identify the optimal caliper and determine whether the propensity score paradox described in King and Nielsen (2019), in which tightening the caliper worsens balance, is in effect."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MatchingFrontier</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/MatchingFrontier.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/psm-paradox.html">Examining the Propensity Score Matching Paradox</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/IQSS/MatchingFrontier/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Compute the balance-sample size frontier for a <code>matchit</code> object</h1>
    
    <div class="hidden name"><code>makeFrontier.matchit.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code><a href="makeFrontier.html">makeFrontier()</a></code> computes the balance-sample size frontier for a <code>matchit</code> object aftr 1:1 matching. The frontier corresponds to the relationship between the number of matched pairs dropped and the resulting balance in the matched sample. When the propensity score is used to match, this can also correspond to the realtionship between the width of a hypothetical caliper on the propensity score and the resulting balance. This helps identify the optimal caliper and determine whether the propensity score paradox described in King and Nielsen (2019), in which tightening the caliper worsens balance, is in effect.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for matchit</span></span>
<span><span class="fu"><a href="makeFrontier.html">makeFrontier</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>             metric <span class="op">=</span> <span class="st">'dist'</span>,</span>
<span>             breaks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>             distance.mat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>             data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>             verbose <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>a <code>matchit</code> object; the output of a call to <code><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">MatchIt::matchit()</a></code> in which 1:1 matching (with or without replacement) was used.</p></dd>

  <dt>metric</dt>
<dd><p>the imbalance metric under consideration; allowable options include <code>'dist'</code>, <code>'L1'</code>, <code>'L2'</code>, and <code>'energy'</code>. See <code><a href="makeFrontier.html">makeFrontier()</a></code>. Default is <code>'dist'</code>.</p></dd>

  <dt>breaks</dt>
<dd><p>when <code>metric</code> is <code>'L1'</code> or <code>'L2'</code>, a named list containing a single number giving the number of bins for each or a string corresponding to a method of computing the number of bins for each covariate. See <code><a href="makeFrontier.html">makeFrontier()</a></code> for allowable options. Ignored for other <code>metric</code>s.</p></dd>

  <dt>distance.mat</dt>
<dd><p>when <code>metric</code> is <code>'dist'</code> or <code>'energy'</code>, the distance measure used to define the distance between units. The default for <code>metric = 'dist'</code> is <code>"mahalanobis"</code> and for <code>metric = 'energy'</code> is <code>"scaled_euclidean"</code>. See <code><a href="makeFrontier.html">makeFrontier()</a></code>. Abbreviations allowed. Ignored for other <code>metric</code>s.</p></dd>

  <dt>data</dt>
<dd><p>an optional data frame containing the variables used in the original matching. In most cases, does not need to be specified, but it is always safer if it is. Passed to <code><a href="https://kosukeimai.github.io/MatchIt/reference/match.data.html" class="external-link">match.data()</a></code>.</p></dd>

  <dt>verbose</dt>
<dd><p><code>logical</code>; whether to print additional information about the frontier constructing process.</p></dd>

  <dt>...</dt>
<dd><p>arguments passed to other methods (ignored).</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>makeFrontier.matchit()</code> creates a balance-sample size "frontier" from the supplied <code>matchit</code> object by dropping pairs one-by-one based on the distance between them and computing a balance statistic at each point. Unlike other frontiers, which are formed by dropping units that lower the imbalance measure the most, <code>matchit</code> frontiers are formed by dropping pairs with the greatest distance between them, where the distance corresponds to the distance used to initially create the matches in <code>matchit()</code> (i.e., the porpensity score difference or Mahalanobis distance, whichever is requested). This is similar to progressively applying a tighter and tighter caliper and considering how balance changes as the caliper is tightened. Because of this, imbalance may increase as pairs are dropped; indeed, this is the phenomenon this function is used to examine.</p>
<p><code>makeFrontier.matchit()</code> is only compatible with <code>matchit</code> objects that result from performing 1:1 matching (with or without replacement), which includes after using <code>method = "nearest"</code>, <code>method = "optimal"</code>, or <code>method = "genetic"</code> in <code>matchit()</code> with <code>ratio = 1</code>. The <code>distance</code> argument to <code>matchit()</code> cannot have been a matrix, but can be a numeric vector corresponding to propensity scores or a string requesting propensity scores or a distance matrix. When the <code>mahvars</code> argument is used to perform Mahalanobis distance matching (with a propensity score otherwise estimated), the propensity score difference is used to determine the order the pairs will be dropped.</p>
<p>Because the frontier is computed using the existing matched dataset, manually creating a frontier by progressively tightening the caliper may not yield the same results unless matching with replacement. When a caliper is supplied to <code>matchit()</code>, the resulting matched sample will have the caliper applied already, so <code><a href="makeFrontier.html">makeFrontier()</a></code> will only produce the frontier for calipers more restrictive than the one used in the original matching.</p>
<p><code>makeFrontier.matchit()</code> extracts the treatment, covariates, propensity score (if any), and estimand (QOI) from the supplied <code>matchit</code> object. If Mahalanobis distance matching was used, the Mahalanobis distance between members of each pair is re-computed. The user must specify which imbalance metric is to be used to assess balance in the resulting matched sample (and any other arguments used to compute it). Because both members of each pair are progressively dropped, the estimand after dropping some pairs corresponds to the "feasible" average treatment effect (in the treated); see <code><a href="makeFrontier.html">makeFrontier()</a></code> for more details.</p>
<p>The covariates used to compute the imbalance metrics are those extracted from the <code>matchit</code> formula using <code><a href="https://rdrr.io/r/base/allnames.html" class="external-link">all.vars()</a></code>; that is, if, e.g., <code>log(X)</code> is present in the model formula, <code>X</code> will be used in computing the imbalance metric, not <code>log(X)</code>.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>MatchItfrontier</code> object, which inherits from <code>matchFrontier</code>.</p>
<dl><dt>frontier</dt>
<dd><p>the matching frontier, which contains four components:</p><ul><li><p><code>drop.order</code>: a list containing the indices of the units dropped at each point on the frontier. The first entry will be empty, indicating that no units have been dropped.</p></li>
<li><p><code>Xs</code>: a vector containing the cumulative number of units dropped at each point on the frontier. The first value will be 0.</p></li>
<li><p><code>Ys</code>: a vector containing the value of the imbalance metric at each point on the frontier.</p></li>
<li><p><code>Y.origin</code>: for bin- and energy-based frontiers, the value of the imbalance metric prior to matching (i.e., before the first point on the frontier).</p></li>
</ul></dd>

<dt>treatment</dt>
<dd><p>the name of the treatment variable.</p></dd>

<dt>QOI</dt>
<dd><p>the QOI; here, <code>"FSATT"</code>.</p></dd>

<dt>metric</dt>
<dd><p>the argument supplied to <code>metric</code>.</p></dd>

<dt>data</dt>
<dd><p>the dataset containing the units. This is the result of call <code><a href="https://kosukeimai.github.io/MatchIt/reference/match.data.html" class="external-link">MatchIt::match.data()</a></code> on the <code>matchit</code> object with <code>drop.unmatched = FALSE</code>.</p></dd>

<dt>match.on</dt>
<dd><p>a vector of the names of the covariates used in the matching.</p></dd>

<dt>matched.to</dt>
<dd><p>the indices of the units to which each unit is paired. Control units will have <code>NA</code> values. This is formed by processing the <code>match.matrix</code> component of the <code>matchit</code> object.</p></dd>

<dt>distance</dt>
<dd><p>the pairwise distances between each pair of units use in the original matching. When propensity score matching is used, these values are scaled by the standard deviation of the propensity score. Note this is different from (but is computed from) the <code>distance</code> component in the supplied <code>matchit</code> object, which contains the propensity scores, and is totally distinct from the <code>distance.mat</code> argument.</p></dd>

<dt>call</dt>
<dd><p>the original call to <code><a href="makeFrontier.html">makeFrontier()</a></code>.</p></dd>

<dt>n</dt>
<dd><p>the number of treated units present at the first point in the frontier.</p></dd>

</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>King, G., Lucas, C., &amp; Nielsen, R. A. (2017). The Balance-Sample Size Frontier in Matching Methods for Causal Inference. <em>American Journal of Political Science</em>, 61(2), 473-489. <a href="https://doi.org/10.1111/ajps.12272" class="external-link">doi:10.1111/ajps.12272</a></p>
<p>King, G., &amp; Nielsen, R. (2019). Why Propensity Scores Should Not Be Used for Matching. Political Analysis, 1-20. <a href="https://doi.org/10.1017/pan.2019.11" class="external-link">doi:10.1017/pan.2019.11</a></p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Noah Greifer</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p># Help pages for other matchit methods</p>
<p><code><a href="makeFrontier.html">makeFrontier()</a></code> for creating frontiers without <span class="pkg">MatchIt</span></p>
<p><code><a href="plot.matchFrontier.html">plot.matchFrontier()</a></code> for plotting the frontier.</p>
<p><code><a href="estimateEffects.html">estimateEffects()</a></code> for estimating effects along the frontier.</p>
<p>vignette("MatchingFrontier") for a worked example.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"MatchIt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#1:1 nearest neighbor propensity score matching</span></span></span>
<span class="r-in"><span><span class="co">#without replacement</span></span></span>
<span class="r-in"><span><span class="va">m.out</span> <span class="op">&lt;-</span> <span class="fu">MatchIt</span><span class="fu">::</span><span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">matchit</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">lalonde</span>, method <span class="op">=</span> <span class="st">"nearest"</span>,</span></span>
<span class="r-in"><span>  ratio <span class="op">=</span> <span class="fl">1</span>, replace <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m.out</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A matchit object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: 1:1 nearest neighbor matching without replacement</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - distance: Propensity score</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              - estimated with logistic regression</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614 (original), 370 (matched)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - target estimand: ATT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, married, re74</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Assess the energy distance as pairs are dropped</span></span></span>
<span class="r-in"><span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="makeFrontier.html">makeFrontier</a></span><span class="op">(</span><span class="va">m.out</span>, metric <span class="op">=</span> <span class="st">"energy"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Computing distance matrix...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calculating frontier...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Done!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fm</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A matchFrontier object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - quantity of interest: FSATT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - imbalance metric: energy distance</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - treatment: treat</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - covariates: age, educ, married, re74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - number of points: 176</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fm</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="makeFrontier.matchit-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fm</span>, axis <span class="op">=</span> <span class="st">"caliper"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="makeFrontier.matchit-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Gary King, Christopher Lucas, Richard Nielsen, Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

